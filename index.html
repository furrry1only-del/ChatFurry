<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChatFury ‚Äî Advanced</title>
  <style>
    :root{
      --bg:#0b0b0b; --panel:#0f0f10; --muted:#9aa0a6; --accent:#ffffff;
      --user-bg:#273042; --bot-bg:#1a1f24; --accent-2:#6cf;
      --glass: rgba(255,255,255,0.03);
    }
    [data-theme="light"]{
      --bg:#f4f6f8; --panel:#ffffff; --muted:#546070; --accent:#0b1220; --user-bg:#e7f0ff; --bot-bg:#eef3f7; --glass: rgba(10,20,30,0.03);
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--accent)}

    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .widget{width:420px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);box-shadow:0 12px 40px rgba(2,6,23,0.6);border:1px solid var(--glass);overflow:hidden}

    header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--glass)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,#14181b,#0f1112);display:flex;align-items:center;justify-content:center;font-weight:700}
    .brand h1{margin:0;font-size:18px}
    .brand p{margin:0;font-size:12px;color:var(--muted)}

    .actions{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:1px solid var(--glass);padding:8px;border-radius:9px;cursor:pointer;color:var(--muted)}
    .icon-btn:hover{opacity:0.95}

    .panel{padding:12px 16px;display:flex;flex-direction:column;gap:10px;background:transparent}
    .controls{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .controls .left{display:flex;gap:8px;align-items:center}

    .select, .btn, .toggle{background:transparent;border:1px solid var(--glass);color:var(--muted);padding:6px 8px;border-radius:8px}
    .btn{cursor:pointer}

    .messages{height:340px;overflow:auto;padding-right:8px;display:flex;flex-direction:column;gap:12px}
    .bubble{max-width:78%;padding:12px 14px;border-radius:12px;line-height:1.4;position:relative}
    .bubble.bot{background:var(--bot-bg);align-self:flex-start}
    .bubble.user{background:var(--user-bg);align-self:flex-end}
    .bubble .meta{display:flex;gap:8px;font-size:12px;color:var(--muted);margin-top:6px}

    .msg-actions{position:absolute;top:6px;right:6px;display:flex;gap:6px}
    .msg-actions button{background:transparent;border:none;color:var(--muted);cursor:pointer;padding:6px;border-radius:8px}

    .composer{display:flex;gap:8px;padding:12px;border-top:1px solid var(--glass);align-items:center;flex-wrap:wrap}
    textarea{flex:1;min-height:44px;padding:10px 12px;border-radius:12px;border:1px solid var(--glass);background:transparent;color:var(--accent);resize:none;font-size:14px}
    .send{padding:10px 12px;border-radius:10px;border:1px solid var(--glass);cursor:pointer}

    .footer{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;font-size:13px;color:var(--muted);border-top:1px solid var(--glass)}

    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{width:420px;background:var(--panel);padding:16px;border-radius:12px;border:1px solid var(--glass)}
    .modal h3{margin:0 0 8px 0}
    .row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}

    @media (max-width:480px){.widget{width:100%;border-radius:10px}.messages{height:300px}}

  </style>
</head>
<body data-theme="dark">
  <div class="wrap">
    <div class="widget" role="region" aria-label="ChatFury">
      <header>
        <div class="brand">
          <div class="logo">‚ö°</div>
          <div>
            <h1>ChatFury</h1>
            <p class="small" id="langLabel">–ú–æ–≤–∞: auto</p>
          </div>
        </div>
        <div class="actions">
          <button class="icon-btn" id="themeToggle" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">üåì</button>
          <button class="icon-btn" id="settingsBtn" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">‚öôÔ∏è</button>
        </div>
      </header>

      <div class="panel">
        <div class="controls">
          <div class="left">
            <select id="modelSelect" class="select" title="Model">
              <option value="gpt-4">gpt-4</option>
              <option value="gpt-3.5-turbo" selected>gpt-3.5-turbo</option>
            </select>
            <button id="exportBtn" class="btn">Export</button>
            <button id="importBtn" class="btn">Import</button>
          </div>
          <div class="right small">–ò—Å—Ç–æ—Ä—ñ—è: <span id="count">0</span></div>
        </div>

        <div class="messages" id="messages" aria-live="polite"></div>

        <div class="composer">
          <textarea id="input" placeholder="–í–≤–µ–¥–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."></textarea>
          <button id="sendBtn" class="send">Send</button>
          <button id="stopBtn" class="send" title="Stop current request">Stop</button>
          <input id="imageInput" type="file" accept="image/*" style="display:none" />
          <button id="imageBtn" class="send" title="Attach image">üì∑</button>
          <button id="voiceBtn" class="send" title="Voice input">üé§</button>
        </div>
      </div>

      <div class="footer">
        <div class="small">ChatFurry –°—Ç–≤–æ—Ä–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±–∞–∑–∏ —Ä–æ–∑—É–º—ñ–Ω–Ω—è Furry</div>
        <div class="small" id="status">&nbsp;</div>
      </div>
    </div>
  </div>

  <div class="modal-back" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ChatFury</h3>
      <div class="small" style="margin-bottom:8px">–ù–∞–ª–∞—à—Ç—É–π –º–æ–¥–µ–ª—å, –º–æ–≤—É, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –≤—Å—Ç–∞–≤ API key.</div>

      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="row">
          <label class="small" style="width:100px">Model</label>
          <select id="modelSelectModal" class="select">
            <option value="gpt-4">gpt-4</option>
            <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
          </select>
        </div>

        <div class="row">
          <label class="small" style="width:100px">Language</label>
          <select id="langSelect" class="select">
            <option value="auto">Auto (detect)</option>
            <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
            <option value="ru">–†–æ—Å—ñ–π—Å—å–∫–∞</option>
            <option value="en">English</option>
          </select>
        </div>

        <div class="row">
          <label class="small" style="width:100px">Temperature</label>
          <input id="temp" type="range" min="0" max="1" step="0.05" value="0.7" style="flex:1" />
        </div>

        <div>
          <label class="small">OpenAI API Key</label>
          <textarea id="apiKeyInput" rows="2" style="width:100%;border:1px solid var(--glass);padding:8px;border-radius:8px;background:transparent;color:var(--accent)"></textarea>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button class="btn" id="closeSettings">Close</button>
          <button class="btn" id="saveSettings">Save</button>
        </div>
      </div>
    </div>
  </div>

  <input id="importFile" type="file" accept="application/json" style="display:none" />

  <script>
    const OPENAI_API_KEY = "proj_6CyaEqt997DSbfbJ09COhjc3";
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const stopBtn = document.getElementById('stopBtn');
    const imageBtn = document.getElementById('imageBtn');
    const imageInput = document.getElementById('imageInput');
    const voiceBtn = document.getElementById('voiceBtn');

    let recognition;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'uk-UA';
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.onresult = (e)=>{
        inputEl.value += (inputEl.value?' ':'') + e.results[0][0].transcript;
      };
    }

    voiceBtn.addEventListener('click', ()=>{
      if (!recognition) { alert('SpeechRecognition –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è'); return; }
      recognition.start();
    });

    imageBtn.addEventListener('click', ()=> imageInput.click());
    imageInput.addEventListener('change', ()=>{
      const file = imageInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        appendMessage('user', '[image attached]');
        // –¢—É—Ç –º–æ–∂–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ base64/URL —Ñ–∞–π–ª—É –Ω–∞ –±–µ–∫–µ–Ω–¥ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É
      };
      reader.readAsDataURL(file);
    });

    sendBtn.addEventListener('click', onSend);
    inputEl.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        onSend();
      }
    });

    function appendMessage(role, content){
      const el = document.createElement('div');
      el.className = 'bubble ' + (role==='user'?'user':'bot');
      el.textContent = content;
      messagesEl.appendChild(el);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function onSend(){
      const text = inputEl.value.trim();
      if (!text) return;
      appendMessage('user', text);
      inputEl.value='';
    }
  </script>
</body>
</html>
